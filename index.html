<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desa Srigonco UMKM</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Poppins, Pacifico, and Comic Neue for comic style -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;600;700;800&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for better aesthetics and responsiveness */
        body {
            font-family: 'Poppins', sans-serif; /* Changed font to Poppins */
            background-color: #FFFBF0; /* Light cream background */
            color: #333;
            line-height: 1.6;
            /* Subtle background pattern (adjusted color for cream background) */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23FDF5E6' fill-opacity='0.4'%3E%3Cpath d='M30 15a15 15 0 1 1 0 30 15 15 0 0 1 0-30zm0 2a13 13 0 1 0 0 26 13 13 0 0 0 0-26zM0 0h60v60H0z' fill='%23FDF5E6'/%3E%3C/g%3E%3C/svg%3E");
        }
        /* Ensure main content has padding to avoid being hidden by fixed header */
        main {
            padding-top: 80px; /* Adjust based on header height */
        }
        /* Smooth scroll for anchor links */
        html {
            scroll-behavior: smooth;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-4 {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* Mobile menu specific styles */
        .mobile-menu-overlay {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .mobile-menu-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .mobile-menu-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        /* Modal specific styles */
        .modal {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            transform: scale(0.95);
            visibility: hidden;
        }
        .modal.open {
            opacity: 1;
            transform: scale(1);
            visibility: visible;
        }
        /* Carousel specific styles */
        .carousel-item {
            display: none;
            transition: opacity 0.6s ease-in-out; /* Smooth fade transition */
        }
        .carousel-item.active {
            display: block;
            opacity: 1;
        }
        .carousel-item:not(.active) {
            opacity: 0;
        }
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #0d9488; /* Tailwind teal-600 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Star rating hover effect */
        .rating-star {
            color: #d1d5db; /* gray-300 */
            transition: color 0.15s ease-in-out, transform 0.1s ease-in-out;
        }
        .rating-star.filled {
            color: #facc15; /* yellow-400 */
        }
        .rating-star:hover {
            transform: scale(1.1);
        }

        /* Custom styles for hero section overlay */
        .hero-overlay {
            background-image: linear-gradient(to bottom, rgba(0,0,0,0.5), rgba(0,0,0,0.8));
            backdrop-filter: blur(2px); /* Subtle blur effect */
        }
        .hero-overlay h1, .hero-overlay p {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6); /* Text shadow for better readability */
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        .animate-fadeInUp.delay-100 { animation-delay: 0.1s; }
        .animate-fadeInUp.delay-200 { animation-delay: 0.2s; }
        .animate-fadeInUp.delay-300 { animation-delay: 0.3s; }
        .animate-fadeInUp.delay-400 { animation-delay: 0.4s; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fadeIn {
            animation: fadeIn 0.8s ease-out forwards;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
        }
        .animate-bounce-once:hover {
            animation: bounce 0.5s ease-in-out;
        }

        /* Text reveal/typewriter effect */
        .text-reveal {
            opacity: 0;
            animation: textReveal 1.5s forwards;
            animation-timing-function: cubic-bezier(0.77, 0, 0.175, 1);
        }

        @keyframes textReveal {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom alert/confirm modal styling */
        .custom-modal-backdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000; /* Higher than other modals */
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            visibility: hidden;
        }
        .custom-modal-backdrop.open {
            opacity: 1;
            visibility: visible;
        }
        .custom-modal-content {
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
            padding: 2.5rem; /* p-10 */
            max-width: 28rem; /* max-w-md */
            margin: auto;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s ease-in-out;
        }
        .custom-modal-backdrop.open .custom-modal-content {
            transform: scale(1);
        }
        /* Parallax effect for hero section */
        .parallax-bg {
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        /* Card hover effect with border and deeper shadow */
        .card-hover-effect:hover {
            border-color: #0d9488; /* teal-600 */
            border-width: 2px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); /* Deeper shadow on hover */
        }

        /* Button gradient effect */
        .btn-gradient-hover {
            background-image: linear-gradient(to right, #0d9488, #14b8a6); /* teal-600 to teal-500 */
            transition: all 0.3s ease;
        }
        .btn-gradient-hover:hover {
            background-image: linear-gradient(to right, #14b8a6, #0d9488);
            box-shadow: 0 4px 15px rgba(13, 148, 136, 0.4);
        }

        /* Chatbot specific styles */
        #chatbot-button {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background-color: #0d9488; /* teal-600 */
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }
        #chatbot-button:hover {
            transform: scale(1.1);
            background-color: #0f766e; /* darker teal */
        }

        #chatbot-container {
            position: fixed;
            bottom: 90px; /* Above the button */
            right: 24px;
            width: 350px;
            height: 500px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 100;
            transform: translateY(20px) scale(0.95);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #chatbot-container.open {
            transform: translateY(0) scale(1);
            opacity: 1;
            visibility: visible;
        }

        #chatbot-header {
            background-color: #0d9488; /* teal-600 */
            color: white;
            padding: 16px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #chatbot-messages {
            flex-grow: 1;
            padding: 16px;
            overflow-y: auto;
            background-color: #f0fdfa; /* teal-50 */
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .message-bubble {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.4;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .user-message {
            background-color: #14b8a6; /* teal-500 */
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .bot-message {
            background-color: #e0f2f7; /* light blue */
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        #chatbot-input-container {
            display: flex;
            padding: 16px;
            border-top: 1px solid #e2e8f0; /* gray-200 */
        }
        #chatbot-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #cbd5e1; /* gray-300 */
            border-radius: 20px;
            margin-right: 10px;
            font-size: 1rem;
        }
        #chatbot-send-button {
            background-color: #0d9488; /* teal-600 */
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
        }
        #chatbot-send-button:hover {
            background-color: #0f766e; /* darker teal */
        }
        /* Responsive adjustments for chatbot */
        @media (max-width: 768px) {
            #chatbot-container {
                width: 90%;
                height: 80%;
                bottom: 16px;
                right: 5%;
                left: 5%;
                max-width: unset; /* Remove max-width for mobile */
            }
            #chatbot-button {
                bottom: 16px;
                right: 16px;
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            /* Adjust header font size for smaller screens */
            .header-title {
                font-size: 1.75rem; /* text-3xl for mobile */
            }
        }

        /* Typing indicator animation */
        .typing-indicator span {
            display: inline-block;
            animation: bounce-dot 1.4s infinite ease-in-out;
            animation-fill-mode: both;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: .2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: .4s;
        }

        @keyframes bounce-dot {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        /* Custom text shadow utilities */
        .text-shadow-sm {
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
        }
        .text-shadow-md {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .text-shadow-lg {
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.6);
        }

        /* New: Card tilt effect on hover */
        .card-tilt-effect:hover {
            transform: translateY(-5px) rotateX(3deg) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        .card-tilt-effect {
            transition: all 0.3s ease-in-out;
            transform-style: preserve-3d;
        }

        /* New: Gradient button with subtle border */
        .btn-primary-gradient {
            background-image: linear-gradient(to right, #0d9488, #14b8a6);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        .btn-primary-gradient:hover {
            background-image: linear-gradient(to right, #14b8a6, #0d9488);
            box-shadow: 0 6px 20px rgba(13, 148, 136, 0.5);
            transform: translateY(-2px);
        }

        /* New: Secondary button style */
        .btn-secondary {
            background-color: #3b82f6; /* blue-500 */
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #2563eb; /* blue-600 */
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }

        /* New: Category button active state */
        .category-button.active {
            background-image: linear-gradient(to right, #0d9488, #14b8a6);
            color: white;
            box-shadow: 0 4px 10px rgba(13, 148, 136, 0.3);
            transform: translateY(-2px);
        }
        .category-button {
            transition: all 0.2s ease-in-out;
        }
        .category-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Specific style for the header title font */
        .header-title {
            font-family: 'Pacifico', cursive; /* Apply Pacifico font */
        }

        /* Navbar specific styles */
        .navbar-link-hover-effect {
            position: relative;
        }
        .navbar-link-hover-effect::after {
            content: '';
            position: absolute;
            bottom: -4px; /* Adjust based on desired distance from text */
            left: 0;
            width: 100%;
            height: 2px; /* Thickness of the underline */
            background-color: #0d9488; /* Teal-600 */
            transform: scaleX(0);
            transition: transform 0.3s ease-out;
            transform-origin: bottom left;
        }
        .navbar-link-hover-effect:hover::after,
        .navbar-link-hover-effect.active::after {
            transform: scaleX(1);
        }
        .navbar-link-hover-effect.active {
            font-weight: 700; /* Bold for active link */
            color: #0d9488; /* Teal-600 for active link */
        }

        /* Comic/Folktale style for sections and cards */
        .comic-section-title {
            font-family: 'Pacifico', cursive;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.2), 5px 5px 0px rgba(0,0,0,0.1); /* Comic-like shadow */
            color: #4a2c00; /* Dark brown for text */
        }
        .comic-section-bg {
            background-image: linear-gradient(to bottom right, #fffbeb, #fef3c7); /* Warm, paper-like gradient */
            border: 4px solid #d97706; /* Strong orange-700 border for comic effect */
            box-shadow: 8px 8px 0px -2px rgba(139, 69, 19, 0.6); /* More pronounced offset shadow */
            border-radius: 1.5rem; /* rounded-3xl */
            transition: all 0.3s ease-in-out;
            padding: 3rem; /* Consistent padding for sections */
        }
        .comic-section-bg:hover {
            transform: translate(-5px, -5px); /* Slight lift on hover */
            box-shadow: 12px 12px 0px -2px rgba(139, 69, 19, 0.8);
        }

        .comic-card {
            background-image: linear-gradient(to bottom right, #fffbeb, #fef3c7); /* Warm, paper-like gradient */
            border: 2px solid #8b4513; /* Brown border */
            box-shadow: 6px 6px 0px -2px rgba(139, 69, 19, 0.4); /* Offset shadow for comic effect */
            transition: all 0.2s ease-in-out;
        }
        .comic-card:hover {
            transform: translate(-3px, -3px); /* Slight lift */
            box-shadow: 9px 9px 0px -2px rgba(139, 69, 19, 0.6);
        }
        .comic-icon {
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3)); /* Icon shadow */
        }

        /* Adjustments for specific sections to fit comic theme */
        /* Why Choose Us section */
        .why-choose-us-section {
            background-image: linear-gradient(to bottom right, #fffbeb, #fef3c7);
            border: 4px solid #d97706;
            box-shadow: 8px 8px 0px -2px rgba(139, 69, 19, 0.6);
            border-radius: 1.5rem;
            transition: all 0.3s ease-in-out;
            padding: 3rem; /* Consistent padding for sections */
        }
        .why-choose-us-section:hover {
            transform: translate(-5px, -5px);
            box-shadow: 12px 12px 0px -2px rgba(139, 69, 19, 0.8);
        }
        .why-choose-us-card {
            background-image: linear-gradient(to bottom right, #ffffff, #fdf9e9); /* Lighter, subtle comic card */
            border: 2px solid #a0522d; /* Sienna-like border */
            box-shadow: 4px 4px 0px -1px rgba(160, 82, 45, 0.3);
            transition: all 0.3s ease;
        }
        .why-choose-us-card:hover {
            transform: translateY(-5px) translateX(-2px);
            box-shadow: 8px 8px 0px -1px rgba(160, 82, 45, 0.5);
            border-color: #d97706;
        }
        .why-choose-us-icon {
            color: #d97706; /* Default orange-700 */
            filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.2));
        }
        .why-choose-us-card:nth-child(2) .why-choose-us-icon { color: #3b82f6; } /* Blue */
        .why-choose-us-card:nth-child(3) .why-choose-us-icon { color: #facc15; } /* Yellow */


        /* Quick Contact Section */
        .contact-section-bg {
            background-image: linear-gradient(to right, #d97706, #fbbf24); /* Orange-700 to Amber-400 */
            border: 4px solid #9a3412; /* Darker orange border */
            box-shadow: 8px 8px 0px -2px rgba(154, 52, 18, 0.6);
            border-radius: 1.5rem;
            transition: all 0.3s ease-in-out;
            padding: 3rem; /* Consistent padding for sections */
        }
        .contact-section-bg:hover {
            transform: translate(-5px, -5px);
            box-shadow: 12px 12px 0px -2px rgba(154, 52, 18, 0.8);
        }
        .contact-button-primary {
            background-color: white;
            color: #d97706; /* Orange-700 */
            border: 2px solid #d97706;
            transition: all 0.3s ease;
        }
        .contact-button-primary:hover {
            background-color: #d97706;
            color: white;
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.4);
            transform: translateY(-2px);
        }
        .contact-button-secondary {
            background-color: transparent;
            color: white;
            border: 2px solid white;
            transition: all 0.3s ease;
        }
        .contact-button-secondary:hover {
            background-color: white;
            color: #d97706; /* Orange-700 */
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        /* Footer specific styles */
        .footer-comic-bg {
            background-image: linear-gradient(to bottom right, #4a2c00, #8b4513); /* Dark brown to sienna gradient */
            border-top: 4px solid #d97706; /* Orange-700 border at the top */
            box-shadow: 0 -8px 0px -2px rgba(139, 69, 19, 0.6); /* Offset shadow upwards */
            color: #fef3c7; /* Light paper-like color for text */
            padding: 2.5rem; /* py-10, px-4 md:px-8 */
        }
        .footer-comic-bg h3 {
            color: #facc15; /* Yellow-400 for titles */
            text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
        }
        .footer-comic-bg .text-gray-400, .footer-comic-bg .text-gray-500 {
            color: #fef3c7; /* Light paper-like color for general text */
        }
        .footer-comic-bg a, .footer-comic-bg button {
            color: #fef3c7; /* Light paper-like color for links/buttons */
            transition: color 0.3s ease;
        }
        .footer-comic-bg a:hover, .footer-comic-bg button:hover {
            color: #facc15; /* Yellow-400 on hover */
        }
        .footer-comic-bg .border-t {
            border-color: #a0522d; /* Sienna border for separator */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-lg py-4 px-6 md:px-8 flex justify-between items-center fixed w-full z-20 top-0 border-b border-gray-200">
        <div class="flex items-center">
            <!-- Logo Image -->
            <img src="IMG/Logo.png" alt="Logo Desa Srigonco UMKM" class="h-20 w-20 mr-4 rounded-full shadow-md border border-gray-100" onerror="this.onerror=null;this.src='https://placehold.co/80x80/ADD8E6/000000?text=Logo';" />
            <span class="text-2xl md:text-3xl lg:text-4xl font-extrabold text-teal-700 text-shadow-sm header-title">UMKM SRIGONCO</span>
        </div>
        <nav class="hidden md:flex space-x-8">
            <button id="nav-home" onclick="navigateTo('home')" class="text-teal-700 hover:text-teal-900 text-lg font-semibold transition duration-300 group relative navbar-link-hover-effect" aria-label="Beranda">
                Beranda
            </button>
            <button id="nav-umkm" onclick="navigateTo('umkm')" class="text-teal-700 hover:text-teal-900 text-lg font-semibold transition duration-300 group relative navbar-link-hover-effect" aria-label="Produk UMKM">
                Produk UMKM
            </button>
            <button id="nav-galeri" onclick="navigateTo('galeri')" class="text-teal-700 hover:text-teal-900 text-lg font-semibold transition duration-300 group relative navbar-link-hover-effect" aria-label="Galeri Foto">
                Galeri
            </button>
        </nav>
        <div class="flex items-center space-x-4">
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-teal-700 hover:text-teal-900 focus:outline-none" aria-label="Buka menu mobile">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay fixed inset-0 bg-gray-800 bg-opacity-95 z-30 flex flex-col items-center justify-center space-y-6 hidden">
        <button id="close-mobile-menu" class="absolute top-6 right-6 text-white hover:text-gray-300 focus:outline-none" aria-label="Tutup menu mobile">
            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <button id="mobile-nav-home" onclick="navigateTo('home')" class="text-white text-3xl font-semibold hover:text-teal-400 transition duration-300" aria-label="Beranda">Beranda</button>
        <button id="mobile-nav-umkm" onclick="navigateTo('umkm')" class="text-white text-3xl font-semibold hover:text-teal-400 transition duration-300" aria-label="Produk UMKM">Produk UMKM</button>
        <button id="mobile-nav-galeri" onclick="navigateTo('galeri')" class="text-white text-3xl font-semibold hover:text-teal-400 transition duration-300" aria-label="Galeri Foto">Galeri</button>
    </div>

    <!-- Main Content Area -->
    <main id="main-content" class="flex-grow">
        <!-- Content will be loaded here by JavaScript -->
    </main>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="spinner"></div>
    </div>

    <!-- Product Image Modal (for full-size image view) -->
    <div id="product-image-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full p-6 relative">
            <button id="close-modal-button" class="absolute top-3 right-3 text-gray-700 hover:text-gray-900 focus:outline-none" aria-label="Tutup modal gambar">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <img id="modal-image" src="" alt="Product Image" class="w-full h-auto rounded-lg max-h-[70vh] object-contain mx-auto" />
            <p id="modal-caption" class="text-center text-gray-700 mt-4 text-lg font-semibold"></p>
            <div class="flex justify-center mt-4">
                <button id="download-image-button" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" aria-label="Unduh gambar">
                    Unduh Gambar
                </button>
            </div>
        </div>
    </div>

    <!-- Product Quick View Modal (for quick product details) -->
    <div id="product-quick-view-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-xl w-full p-6 relative">
            <button id="close-quick-view-modal-button" class="absolute top-3 right-3 text-gray-700 hover:text-gray-900 focus:outline-none" aria-label="Tutup modal tampilan cepat">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <img id="quick-view-image" src="" alt="Product Image" class="w-full h-auto rounded-lg shadow-md object-cover max-h-64 md:max-h-full" />
                </div>
                <div>
                    <h3 id="quick-view-name" class="text-2xl font-bold text-gray-900 mb-2"></h3>
                    <div id="quick-view-rating" class="flex items-center mb-3 text-lg"></div>
                    <p id="quick-view-description" class="text-gray-700 text-sm mb-4 line-clamp-4"></p>
                    <p id="quick-view-stock" class="text-gray-700 font-semibold text-sm mb-4"></p>
                    <p id="quick-view-address" class="text-gray-700 text-sm mb-4"></p>
                    <div class="flex flex-col gap-3">
                        <a id="quick-view-whatsapp" href="#" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Beli via WhatsApp">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2C7.34 2 3.54 5.79 3.54 10.49c0 1.76.54 3.42 1.48 4.85L3 21.04l5.24-1.38c1.33.72 2.85 1.15 4.08 1.15 4.71 0 8.5-3.79 8.5-8.49S16.74 2 12.04 2zm3.39 12.24c-.16.27-.99.64-1.37.69-.37.05-.64.08-.92-.08-.27-.16-.99-.37-1.27-.85-.27-.47-.03-.72-.22-.92-.19-.19-.42-.27-.64-.27-.16 0-.34.03-.52.03-.19 0-.47.08-.72.34-.27.27-1.04 1.04-1.04 2.54s1.07 2.94 1.22 3.12c.16.19 2.03 3.12 4.93 4.35 2.39.99 2.85.79 3.34.79.47 0 .99-.19 1.15-.37.16-.19.27-.37.42-.64.16-.27.16-.47.11-.85-.05-.37-.19-.64-.37-.92-.16-.27-.37-.42-.52-.52-.16-.16-.34-.27-.47-.27-.16 0-.34.03-.52.11z" />
                                        </svg>
                            Beli via WhatsApp
                        </a>
                        <button id="quick-view-detail-button" class="inline-flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Lihat detail produk">
                            Lihat Detail Produk
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button id="back-to-top-button" class="fixed bottom-6 right-6 bg-teal-600 hover:bg-teal-700 text-white p-3 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75 hidden" aria-label="Kembali ke atas">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <!-- Chatbot Button -->
    <button id="chatbot-button" aria-label="Buka Chatbot">
        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
        </svg>
    </button>

    <!-- Chatbot Container -->
    <div id="chatbot-container" class="hidden">
        <div id="chatbot-header">
            <h3 class="text-lg font-semibold">Chatbot UMKM Srigonco</h3>
            <button id="close-chatbot-button" class="text-white hover:text-gray-200" aria-label="Tutup Chatbot">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div id="chatbot-messages">
            <!-- Chat messages will appear here -->
            <div class="message-bubble bot-message">Halo! Saya chatbot UMKM Desa Srigonco. Ada yang bisa saya bantu?</div>
        </div>
        <div id="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Ketik pesan Anda..." aria-label="Ketik pesan Anda">
            <button id="chatbot-send-button" aria-label="Kirim Pesan">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer-comic-bg py-8 px-4 md:px-8 text-center mt-auto">
        <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h3 class="text-xl font-bold mb-4">Desa Srigonco UMKM</h3>
                <p>
                    Membangun desa mandiri dan sejahtera melalui potensi alam dan UMKM lokal.
                </p>
            </div>
            <div>
                <h3 class="text-xl font-bold mb-4">Tautan Cepat</h3>
                <ul class="space-y-2">
                    <li><button onclick="navigateTo('home')" class="hover:text-yellow-400 transition duration-300" aria-label="Beranda">Beranda</button></li>
                    <li><button onclick="navigateTo('umkm')" class="hover:text-yellow-400 transition duration-300" aria-label="Produk UMKM">Produk UMKM</button></li>
                    <li><button onclick="navigateTo('galeri')" class="hover:text-yellow-400 transition duration-300" aria-label="Galeri Foto">Galeri</button></li>
                </ul>
            </div>
            <div>
                <h3 class="text-xl font-bold mb-4">Ikuti Kami</h3>
                <div class="flex justify-center space-x-4">
                    <a href="https://facebook.com/desasrigonco" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition duration-300" aria-label="Ikuti kami di Facebook">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.04C6.51 2.04 2 6.55 2 12.04c0 4.93 3.58 9.04 8.28 9.87v-7.05H7.07V12.04h3.21V9.45c0-3.18 1.94-4.91 4.75-4.91 1.35 0 2.51.1 2.85.15v3.1h-1.85c-1.5 0-1.79.71-1.79 1.76v2.31h3.48l-.5 3.53h-2.98V21.91C18.42 21.08 22 16.97 22 12.04 22 6.55 17.49 2.04 12 2.04z"/></svg>
                    </a>
                    <a href="https://instagram.com/desasrigonco" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition duration-300" aria-label="Ikuti kami di Instagram">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M7.8 2h8.4C18.14 2 22 5.86 22 10.2v3.6c0 4.34-3.86 8.2-7.8 8.2H7.8C3.46 22 2 18.14 2 13.8V10.2C2 5.86 3.86 2 7.8 2zm-.2 4A2.88 2.88 0 0 0 4.8 6.8v6.4c0 1.59 1.3 2.88 2.88 2.88h6.4c1.59 0 2.88-1.3 2.88-2.88V6.8c0-1.59-1.3-2.88-2.88-2.88H7.6zm9.6 0a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4zM12 7.2c-2.65 0-4.8 2.15-4.8 4.8s2.15 4.8 4.8 4.8 4.8-2.15 4.8-4.8-2.15-4.8-4.8-4.8zm0 1.6c1.76 0 3.2 1.44 3.2 3.2s-1.44 3.2-3.2 3.2-3.2-1.44-3.2-3.2 1.44-3.2 3.2-3.2z"/></svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="mt-8 border-t pt-6 text-sm">
            &copy; <span id="current-year"></span> Desa Srigonco. Hak Cipta Dilindungi. By KKN UM
        </div>
    </footer>

    <script>
        // Global state variables
        let currentPage = 'home';
        let selectedProduct = null;
        let searchTerm = '';
        let selectedCategory = 'Semua';
        let selectedSort = 'default'; // New state for sorting
        let selectedGalleryCategory = 'Semua'; // New state for gallery filtering
        let showBackToTop = false;
        let currentCarouselIndex = 0; // For hero carousel
        let carouselInterval;
        let showLoading = false;
        let currentProductRating = 0; // For interactive rating

        // Pagination for UMKM and Gallery
        const itemsPerPage = 6;
        let loadedProductCount = itemsPerPage;
        let loadedGalleryCount = itemsPerPage;

        // --- Data ---
        // Moved data definitions inside DOMContentLoaded to ensure they are fully parsed before use.
        let products = [];
        let productCategories = [];
        let galleryImages = [];
        let galleryCategories = [];
        let testimonials = []; // New testimonials data

        // --- Helper Functions ---

        // Debounce function to limit how often a function is called
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        // Generates star rating HTML
        function getStarRatingHtml(rating, isInteractive = false) {
            let starsHtml = '';
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 !== 0; // Check for half star
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

            for (let i = 1; i <= fullStars; i++) {
                starsHtml += `<span class="rating-star ${isInteractive ? 'cursor-pointer' : ''} filled" data-star="${i}" aria-label="${i} bintang">&#9733;</span>`; // Full star
            }
            if (halfStar) {
                // For a true half star, you might use a different unicode or SVG.
                // For simplicity, we'll just add another filled star for half, making it visually round up.
                starsHtml += `<span class="rating-star ${isInteractive ? 'cursor-pointer' : ''} filled" data-star="${fullStars + 1}" aria-label="${fullStars + 1} bintang">&#9733;</span>`;
            }
            for (let i = fullStars + (halfStar ? 1 : 0) + 1; i <= 5; i++) {
                starsHtml += `<span class="rating-star ${isInteractive ? 'cursor-pointer' : ''}" data-star="${i}" aria-label="${i} bintang">&#9733;</span>`; // Empty star
            }
            return starsHtml;
        }


        // Show/hide loading spinner
        function toggleLoading(show) {
            const spinner = document.getElementById('loading-spinner');
            if (spinner) {
                if (show) {
                    spinner.classList.remove('hidden');
                } else {
                    spinner.classList.add('hidden');
                }
            }
        }

        // --- Core Navigation & Rendering ---
        function navigateTo(page, dataId = null) {
            toggleLoading(true); // Show loading spinner
            setTimeout(() => { // Simulate network delay
                currentPage = page;
                selectedProduct = null;
                searchTerm = ''; // Reset search term on page change
                selectedCategory = 'Semua'; // Reset category filter
                selectedSort = 'default'; // Reset sort order
                selectedGalleryCategory = 'Semua'; // Reset gallery category filter
                loadedProductCount = itemsPerPage; // Reset pagination
                loadedGalleryCount = itemsPerPage; // Reset pagination
                currentProductRating = 0; // Reset rating for product detail page

                if (page === 'productDetail' && dataId !== null) {
                    selectedProduct = products.find(p => p.id === dataId);
                    if (selectedProduct) {
                        currentProductRating = selectedProduct.rating; // Set initial rating for display
                    }
                }

                renderContent();
                toggleMobileMenu(false); // Close mobile menu
                window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top
                toggleLoading(false); // Hide loading spinner

                // Update active navigation link
                updateActiveNavLink(); // New function call
            }, 300); // Small delay for effect
        }

        function renderContent() {
            const mainContentDiv = document.getElementById('main-content');
            let contentHtml = '';

            // Clear any previous carousel interval
            if (carouselInterval) {
                clearInterval(carouselInterval);
            }

            switch (currentPage) {
                case 'home':
                    contentHtml = renderHomePage();
                    break;
                case 'umkm':
                    contentHtml = renderUmkmPage();
                    break;
                case 'productDetail':
                    contentHtml = renderProductDetailPage();
                    break;
                case 'galeri':
                    contentHtml = renderGaleriPage();
                    break;
                default:
                    contentHtml = `<div class="text-center py-12 text-gray-600">Halaman tidak ditemukan.</div>`;
            }
            mainContentDiv.innerHTML = contentHtml;

            // Re-attach event listeners for dynamic content
            attachEventListeners();
        }

        function attachEventListeners() {
            // UMKM search input
            const searchInput = document.getElementById('umkm-search-input');
            if (searchInput) {
                // Debounce the search input
                const debouncedSearch = debounce((e) => {
                    searchTerm = e.target.value;
                    loadedProductCount = itemsPerPage; // Reset pagination on new search
                    renderContent();
                }, 300);
                searchInput.removeEventListener('input', debouncedSearch);
                searchInput.addEventListener('input', debouncedSearch);
            }

            // UMKM category filter buttons
            const categoryButtons = document.querySelectorAll('.category-button');
            categoryButtons.forEach(button => {
                button.removeEventListener('click', handleCategoryFilter);
                button.addEventListener('click', handleCategoryFilter);
            });

            // UMKM sort dropdown
            const sortDropdown = document.getElementById('umkm-sort-dropdown');
            if (sortDropdown) {
                sortDropdown.removeEventListener('change', handleSortChange);
                sortDropdown.addEventListener('change', handleSortChange);
            }

            // Gallery category filter buttons
            const galleryCategoryButtons = document.querySelectorAll('.gallery-category-button');
            galleryCategoryButtons.forEach(button => {
                button.removeEventListener('click', handleGalleryCategoryFilter);
                button.addEventListener('click', handleGalleryCategoryFilter);
            });


            // Load More buttons
            const loadMoreProductsBtn = document.getElementById('load-more-products');
            if (loadMoreProductsBtn) {
                loadMoreProductsBtn.removeEventListener('click', loadMoreProducts);
                loadMoreProductsBtn.addEventListener('click', loadMoreProducts);
            }
            const loadMoreGalleryBtn = document.getElementById('load-more-gallery');
            if (loadMoreGalleryBtn) {
                loadMoreGalleryBtn.removeEventListener('click', loadMoreGallery);
                loadMoreGalleryBtn.addEventListener('click', loadMoreGallery);
            }

            // Product/Gallery image click to open modal
            const imagesToModal = document.querySelectorAll('.product-image-thumbnail, .gallery-image-thumbnail');
            imagesToModal.forEach(img => {
                img.removeEventListener('click', handleImageClickToModal);
                img.addEventListener('click', handleImageClickToModal);
            });

            // Close modal button
            const closeModalButton = document.getElementById('close-modal-button');
            if (closeModalButton) {
                closeModalButton.removeEventListener('click', closeImageModal);
                closeModalButton.addEventListener('click', closeImageModal);
            }

            // Download image button in modal
            const downloadImageButton = document.getElementById('download-image-button');
            if (downloadImageButton) {
                downloadImageButton.removeEventListener('click', downloadModalImage);
                downloadImageButton.addEventListener('click', downloadModalImage);
            }

            // Product Quick View buttons
            const quickViewButtons = document.querySelectorAll('.quick-view-button');
            quickViewButtons.forEach(button => {
                button.removeEventListener('click', (e) => openProductQuickViewModal(parseInt(e.currentTarget.dataset.productId)));
                button.addEventListener('click', (e) => openProductQuickViewModal(parseInt(e.currentTarget.dataset.productId)));
            });
            const closeQuickViewModalButton = document.getElementById('close-quick-view-modal-button');
            if (closeQuickViewModalButton) {
                closeQuickViewModalButton.removeEventListener('click', closeProductQuickViewModal);
                closeQuickViewModalButton.addEventListener('click', closeQuickViewModalButton);
            }
            const quickViewDetailButton = document.getElementById('quick-view-detail-button');
            if (quickViewDetailButton) {
                quickViewDetailButton.removeEventListener('click', handleQuickViewDetailClick);
                quickViewDetailButton.addEventListener('click', handleQuickViewDetailClick);
            }


            // Carousel controls (if on home page)
            if (currentPage === 'home') {
                const prevButton = document.getElementById('carousel-prev');
                const nextButton = document.getElementById('carousel-next');
                if (prevButton && nextButton) {
                    prevButton.removeEventListener('click', showPrevCarouselItem);
                    nextButton.removeEventListener('click', showNextCarouselItem);
                    prevButton.addEventListener('click', showPrevCarouselItem);
                    nextButton.addEventListener('click', showNextCarouselItem);
                    startCarousel(); // Start auto-play
                }

                // Attach Intersection Observer for new homepage animations
                setupIntersectionObserver();
            }

            // Interactive Product Rating (if on product detail page)
            if (currentPage === 'productDetail') {
                const ratingInputDiv = document.getElementById('rating-input');
                if (ratingInputDiv) {
                    const stars = ratingInputDiv.querySelectorAll('.rating-star');
                    stars.forEach(star => {
                        star.removeEventListener('mouseover', highlightStars);
                        star.removeEventListener('mouseout', resetStars);
                        star.removeEventListener('click', setRating);

                        star.addEventListener('mouseover', highlightStars);
                        star.addEventListener('mouseout', resetStars);
                        star.addEventListener('click', setRating);
                    });
                    // Initial highlight based on currentProductRating
                    highlightStars(null, currentProductRating);
                }

                // Share product button
                const shareProductButton = document.getElementById('share-product-button');
                if (shareProductButton) {
                    shareProductButton.removeEventListener('click', shareProduct);
                    shareProductButton.addEventListener('click', shareProduct);
                }

                // Copy Link button
                const copyLinkButton = document.getElementById('copy-link-button');
                if (copyLinkButton) {
                    copyLinkButton.removeEventListener('click', copyProductLink);
                    copyLinkButton.addEventListener('click', copyProductLink);
                }
            }

            // Chatbot event listeners
            const chatbotButton = document.getElementById('chatbot-button');
            const closeChatbotButton = document.getElementById('close-chatbot-button');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotSendButton = document.getElementById('chatbot-send-button');

            if (chatbotButton) {
                chatbotButton.removeEventListener('click', toggleChatbot);
                chatbotButton.addEventListener('click', toggleChatbot);
            }
            if (closeChatbotButton) {
                closeChatbotButton.removeEventListener('click', toggleChatbot);
                closeChatbotButton.addEventListener('click', toggleChatbot);
            }
            if (chatbotInput) {
                chatbotInput.removeEventListener('keypress', handleChatInputKeyPress);
                chatbotInput.addEventListener('keypress', handleChatInputKeyPress);
            }
            if (chatbotSendButton) {
                chatbotSendButton.removeEventListener('click', sendChatMessage);
                chatbotSendButton.addEventListener('click', sendChatMessage);
            }
        }

        // --- Page Rendering Functions ---

        function renderHomePage() {
            const carouselItems = [
                {
                    image: 'IMG/banner1.jpg',
                    caption: 'Selamat Datang di Desa Srigonco',
                    subtitle: 'Jelajahi keindahan alam dan kekayaan budaya kami.'
                },
                {
                    image: 'IMG/banner2.jpg',
                    caption: 'Dukung Produk Unggulan UMKM Desa Srigonco',
                    subtitle: 'Kualitas terbaik dari tangan-tangan terampil.'
                },
                {
                    image: 'IMG/banner3.jpg',
                    caption: 'Pesona Alam Desa Srigonco',
                    subtitle: 'Nikmati ketenangan dan keasrian pedesaan.'
                }
            ].map((item, index) => `
                <div class="carousel-item ${index === 0 ? 'active' : ''} relative h-[550px] md:h-[650px] lg:h-[750px] overflow-hidden parallax-bg" style="background-image: url('${item.image}')">
                    <div class="hero-overlay absolute inset-0 flex flex-col items-center justify-center text-white p-4 text-center">
                        <h1 class="text-4xl md:text-6xl font-extrabold mb-4 text-reveal text-shadow-lg" data-aos="fade-up">${item.caption}</h1>
                        <p class="text-lg md:text-2xl mb-8 max-w-3xl text-reveal delay-100" data-aos="fade-up" data-aos-delay="100">${item.subtitle}</p>
                        <button onclick="navigateTo('umkm')" class="btn-primary-gradient text-white font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 animate-bounce-once focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75 text-reveal delay-200" data-aos="fade-up" data-aos-delay="200" aria-label="Jelajahi Sekarang">
                            Jelajahi Sekarang
                        </button>
                    </div>
                </div>
            `).join('');

            return `
                <!-- Hero Section -->
                <section class="relative w-full overflow-hidden mb-16">
                    <div id="image-carousel" class="relative">
                        ${carouselItems}
                    </div>
                    <button id="carousel-prev" class="absolute left-0 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full ml-4 hover:bg-opacity-75 transition duration-300 z-10" aria-label="Previous image">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="carousel-next" class="absolute right-0 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full mr-4 hover:bg-opacity-75 transition duration-300 z-10" aria-label="Next image">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </section>

                <div class="container mx-auto px-4 py-8">
                    <!-- About Srigonco & UMKM Section - Now with Comic/Folktale Design -->
                    <section class="py-16 comic-section-bg mb-16 animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-4xl md:text-5xl font-extrabold text-center mb-10 comic-section-title" data-aos="fade-up">Desa Srigonco: Pusat UMKM Berbudaya</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                            <div class="order-2 md:order-1 text-gray-800">
                                <p class="text-lg leading-relaxed mb-4 font-semibold" data-aos="fade-up" data-aos-delay="100">
                                    Desa Srigonco, di Kecamatan Bantur, Kabupaten Malang, Jawa Timur, adalah rumah bagi UMKM inovatif yang berakar pada kekayaan alam dan budaya lokal. Kami bangga menghadirkan produk-produk berkualitas tinggi yang dibuat dengan dedikasi oleh masyarakat Srigonco.
                                </p>
                                <p class="text-lg leading-relaxed mb-6 font-semibold" data-aos="fade-up" data-aos-delay="200">
                                    Setiap produk UMKM di sini tidak hanya mencerminkan keterampilan dan kreativitas, tetapi juga semangat gotong royong dan komitmen kami untuk memajukan ekonomi desa. Dengan berbelanja di sini, Anda tidak hanya mendapatkan produk unik, tetapi juga turut serta dalam mendukung keberlanjutan dan kesejahteraan komunitas kami.
                                </p>
                                <button onclick="navigateTo('umkm')" class="btn-secondary text-white font-semibold py-3 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Jelajahi Produk Kami">
                                    Jelajahi Produk Kami
                                </button>
                            </div>
                            <div class="order-1 md:order-2">
                                <img src="IMG/Logo.png" alt="Logo Desa Srigonco UMKM" class="rounded-2xl shadow-xl w-full h-auto object-cover border-4 border-amber-500 transform transition duration-500 hover:scale-102 hover:shadow-2xl" onerror="this.onerror=null;this.src='https://placehold.co/600x400/FFDDC1/8B4513?text=Logo+Desa+Srigonco+UMKM';" data-aos="fade-left" />
                            </div>
                        </div>
                    </section>

                    <!-- Our Mission Section - Comic/Folktale Design -->
                    <section class="py-16 comic-section-bg mb-16 animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-4xl md:text-5xl font-extrabold text-center mb-12 comic-section-title" data-aos="fade-up">Misi Kami: Membangun Masa Depan Gemilang</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                            <div class="order-1 md:order-2">
                                <img src="IMG/Misi-kami.png" alt="Misi Kami" class="rounded-2xl shadow-xl w-full h-auto object-cover border-4 border-amber-500 transform transition duration-500 hover:scale-102 hover:shadow-2xl" onerror="this.onerror=null;this.src='https://placehold.co/600x400/FFDDC1/8B4513?text=Misi+Kami';" data-aos="fade-right" />
                            </div>
                            <div class="order-2 md:order-1 text-gray-800">
                                <p class="text-lg leading-relaxed mb-6 font-semibold" data-aos="fade-up" data-aos-delay="100">
                                    Di jantung Desa Srigonco, Kecamatan Bantur, Kabupaten Malang, kami memiliki misi yang kuat: memberdayakan setiap individu dan keluarga melalui pengembangan Usaha Mikro, Kecil, dan Menengah (UMKM) yang berkelanjutan. Kami percaya bahwa dengan mengoptimalkan potensi lokal, kami dapat menciptakan peluang ekonomi yang berkesinambungan, meningkatkan taraf hidup, dan melestarikan warisan budaya serta kearifan lokal yang kaya melalui setiap produk unggulan yang kami hasilkan.
                                </p>
                                <h3 class="text-2xl font-bold text-gray-900 mb-6 mt-8 animate-fadeInUp delay-200" data-aos="fade-up" data-aos-delay="200">Komitmen Kami Berlandaskan Tiga Pilar Utama:</h3>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                                    <div class="p-4 rounded-xl shadow-lg comic-card animate-fadeInUp delay-300" data-aos="fade-up" data-aos-delay="300">
                                        <svg class="w-16 h-16 text-red-600 mx-auto mb-3 comic-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4.636 17.364l-.707.707M3 12H2m15.364 4.636l.707.707M12 21v-1m-6.364-1.636l-.707-.707M12 12a9 9 0 110 0 9 9 0 010 0z"></path></svg>
                                        <p class="font-bold text-gray-800 text-xl font-['Comic_Neue']">Inovasi</p>
                                    </div>
                                    <div class="p-4 rounded-xl shadow-lg comic-card animate-fadeInUp delay-400" data-aos="fade-up" data-aos-delay="400">
                                        <svg class="w-16 h-16 text-blue-600 mx-auto mb-3 comic-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                        <p class="font-bold text-gray-800 text-xl font-['Comic_Neue']">Kualitas</p>
                                    </div>
                                    <div class="p-4 rounded-xl shadow-lg comic-card animate-fadeInUp delay-500" data-aos="fade-up" data-aos-delay="500">
                                        <svg class="w-16 h-16 text-green-600 mx-auto mb-3 comic-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                        <p class="font-bold text-gray-800 text-xl font-['Comic_Neue']">Integritas</p>
                                    </div>
                                </div>
                                <p class="text-lg leading-relaxed mt-6 font-semibold" data-aos="fade-up" data-aos-delay="600">
                                    Dengan demikian, setiap pembelian yang Anda lakukan tidak hanya memberikan kepuasan, tetapi juga secara langsung berkontribusi pada pembangunan komunitas dan masa depan yang lebih cerah bagi Desa Srigonco.
                                </p>
                            </div>
                        </div>
                    </section>

                    <!-- Why Choose Us Section - Strong & Professional Design -->
                    <section class="py-16 why-choose-us-section mb-16 animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 text-center mb-12 comic-section-title" data-aos="fade-up">Mengapa Memilih Produk UMKM Kami?</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                            <div class="p-8 rounded-2xl why-choose-us-card transform transition duration-300 hover:scale-105" data-aos="fade-up" data-aos-delay="100">
                                <svg class="w-24 h-24 why-choose-us-icon mx-auto mb-6 drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3">Produk Asli & Berkualitas</h3>
                                <p class="text-gray-600 leading-relaxed">Kami menawarkan produk-produk UMKM asli Desa Srigonco dengan kualitas terjamin, dibuat dengan bahan pilihan dan proses yang cermat.</p>
                            </div>
                            <div class="p-8 rounded-2xl why-choose-us-card transform transition duration-300 hover:scale-105" data-aos="fade-up" data-aos-delay="200">
                                <svg class="w-24 h-24 why-choose-us-icon mx-auto mb-6 drop-shadow-md" fill="currentColor" viewBox="0 0 24 24"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H2v-2a3 3 0 015.356-1.857M7 20v-2a3 3 0 00-5.356-1.857M7 20H2v-2a3 3 0 015.356-1.857m0 0A2.5 2.5 0 1014.854 1.146 2.5 2.5 0 0012 10.5a2.5 2.5 0 00-2.854-9.354z"></path></svg>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3">Mendukung Komunitas Lokal</h3>
                                <p class="text-gray-600 leading-relaxed">Setiap pembelian Anda berkontribusi langsung pada kesejahteraan warga desa, membantu mereka tumbuh dan berkembang.</p>
                            </div>
                            <div class="p-8 rounded-2xl why-choose-us-card transform transition duration-300 hover:scale-105" data-aos="fade-up" data-aos-delay="300">
                                <svg class="w-24 h-24 why-choose-us-icon mx-auto mb-6 drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3">Pelayanan Ramah & Cepat</h3>
                                <p class="text-gray-600 leading-relaxed">Kami siap melayani Anda dengan sepenuh hati dan memberikan respons yang cepat untuk setiap pertanyaan atau kebutuhan Anda.</p>
                            </div>
                        </div>
                    </section>

                    <!-- Featured UMKM Products Section - Grid layout -->
                    <section class="py-16 comic-section-bg mb-16 animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-10 comic-section-title" data-aos="fade-up">Produk Unggulan UMKM</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                            ${products.slice(0, 3).map((product, index) => `
                                <div class="bg-white rounded-lg shadow-md overflow-hidden transform transition duration-300 ease-in-out hover:scale-105 hover:shadow-xl comic-card animate-fadeIn" data-aos="fade-up" data-aos-delay="${index * 100}">
                                    <img
                                        src="${product.image}"
                                        alt="${product.name}"
                                        class="w-full h-48 object-cover cursor-pointer product-image-thumbnail"
                                        data-image-src="${product.image}"
                                        data-image-caption="${product.name}"
                                        onerror="this.onerror=null;this.src='https://placehold.co/400x300/ADD8E6/000000?text=${encodeURIComponent(product.name)}';"
                                    />
                                    <div class="p-5">
                                        <h3 class="text-xl font-semibold text-gray-800 mb-2 line-clamp-2">${product.name}</h3>
                                        <div class="flex items-center mb-2">
                                            <div class="text-lg mr-2">${getStarRatingHtml(product.rating)}</div>
                                            <span class="text-gray-600 text-sm">(${product.rating})</span>
                                        </div>
                                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">${product.description}</p>
                                        <div class="flex justify-end items-center">
                                            <button data-product-id="${product.id}" class="btn-primary-gradient text-white text-sm font-medium py-2 px-4 rounded-full transition duration-300 quick-view-button" aria-label="Lihat Cepat ${product.name}">
                                                Lihat Cepat
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="text-center mt-10" data-aos="fade-up" data-aos-delay="400">
                            <button onclick="navigateTo('umkm')" class="btn-secondary text-white font-semibold py-3 px-8 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Lihat Semua Produk UMKM">
                                Lihat Semua Produk UMKM
                            </button>
                        </div>
                    </section>

                    <!-- Featured Gallery Section -->
                    <section class="py-16 comic-section-bg mb-16 animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-10 comic-section-title" data-aos="fade-up">Jelajahi Galeri Kami</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                            ${galleryImages.slice(0, 3).map((img, index) => `
                                <div class="bg-white rounded-lg shadow-md overflow-hidden transform transition duration-300 ease-in-out hover:scale-105 hover:shadow-xl comic-card" data-aos="fade-up" data-aos-delay="${index * 100}">
                                    <img
                                        src="${img.src}"
                                        alt="${img.title}"
                                        class="w-full h-64 object-cover cursor-pointer gallery-image-thumbnail"
                                        data-image-src="${img.src}"
                                        data-image-caption="${img.title}"
                                        onerror="this.onerror=null;this.src='https://placehold.co/800x600/ADD8E6/000000?text=${encodeURIComponent(img.title)}';"
                                    />
                                    <div class="p-4 text-center">
                                        <p class="font-semibold text-gray-800">${img.title}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="text-center mt-10" data-aos="fade-up" data-aos-delay="400">
                            <button onclick="navigateTo('galeri')" class="btn-secondary text-white font-semibold py-3 px-8 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Muat lebih banyak foto galeri">
                                Lihat Semua Foto di Galeri
                            </button>
                        </div>
                    </section>

                    <!-- Testimonials Section - New Section -->
                    <section class="py-16 comic-section-bg mb-16 animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-10 comic-section-title" data-aos="fade-up">Apa Kata Pelanggan Kami?</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                            ${testimonials.map((testimonial, index) => `
                                <div class="comic-card p-6 text-center transform transition duration-300 hover:scale-105" data-aos="fade-up" data-aos-delay="${index * 100}">
                                    <img src="${testimonial.avatar}" alt="${testimonial.name}" class="w-20 h-20 rounded-full mx-auto mb-4 object-cover border-2 border-amber-500" onerror="this.onerror=null;this.src='https://placehold.co/80x80/ADD8E6/000000?text=Avatar';" />
                                    <p class="text-gray-700 italic mb-4 line-clamp-4">"${testimonial.quote}"</p>
                                    <p class="font-semibold text-gray-800">${testimonial.name}</p>
                                    <p class="text-sm text-gray-500">${testimonial.title}</p>
                                </div>
                            `).join('')}
                        </div>
                    </section>

                    <!-- Quick Contact Section -->
                    <section class="py-16 contact-section-bg text-white mb-16 animate-fadeIn text-center" data-aos="fade-up">
                        <h2 class="text-3xl md:text-4xl font-bold mb-6 comic-section-title text-white" data-aos="fade-up">Punya Pertanyaan? Hubungi Kami!</h2>
                        <p class="text-lg mb-8 max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="100">
                            Kami siap membantu Anda. Jangan ragu untuk menghubungi kami melalui WhatsApp untuk respons cepat atau gunakan chatbot kami!
                        </p>
                        <div class="flex flex-col sm:flex-row justify-center items-center gap-6">
                            <a href="https://wa.me/6281234567890?text=Halo%2C%20saya%20punya%20pertanyaan%20tentang%20Desa%20Srigonco." target="_blank" rel="noopener noreferrer" class="inline-flex items-center contact-button-primary font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105" data-aos="fade-up" data-aos-delay="200" aria-label="Chat via WhatsApp">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12.04 2C7.34 2 3.54 5.79 3.54 10.49c0 1.76.54 3.42 1.48 4.85L3 21.04l5.24-1.38c1.33.72 2.85 1.15 4.08 1.15 4.71 0 8.5-3.79 8.5-8.49S16.74 2 12.04 2zm3.39 12.24c-.16.27-.99.64-1.37.69-.37.05-.64.08-.92-.08-.27-.16-.99-.37-1.27-.85-.27-.47-.03-.72-.22-.92-.19-.19-.42-.27-.64-.27-.16 0-.34.03-.52.03-.19 0-.47.08-.72.34-.27.27-1.04 1.04-1.04 2.54s1.07 2.94 1.22 3.12c.16.19 2.03 3.12 4.93 4.35 2.39.99 2.85.79 3.34.79.47 0 .99-.19 1.15-.37.16-.19.27-.37.42-.64.16-.27.16-.47.11-.85-.05-.37-.19-.64-.37-.92-.16-.27-.37-.42-.52-.52-.16-.16-.34-.27-.47-.27-.16 0-.34.03-.52.11z" />
                                        </svg>
                                        Chat via WhatsApp
                            </a>
                            <a href="mailto:info.srigonco@example.com" class="inline-flex items-center contact-button-secondary font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105" data-aos="fade-up" data-aos-delay="300" aria-label="Kirim Email">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-9 13h9A2 2 0 0021 19V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                Kirim Email
                            </a>
                        </div>
                    </section>
                </div>
            `;
        }

        function renderUmkmPage() {
            let filteredProducts = products.filter(product =>
                (selectedCategory === 'Semua' || product.category === selectedCategory) &&
                (product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm.toLowerCase())))
            );

            // Sorting logic (removed price sorting as prices are no longer displayed)
            if (selectedSort === 'name-asc') {
                filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
            } else if (selectedSort === 'name-desc') {
                filteredProducts.sort((a, b) => b.name.localeCompare(a.name));
            }

            const displayedProducts = filteredProducts.slice(0, loadedProductCount);

            const categoryButtonsHtml = productCategories.map(category => `
                <button
                    class="category-button px-5 py-2 rounded-full text-sm font-medium transition duration-300
                    ${selectedCategory === category ? 'active' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}"
                    data-category="${category}"
                    aria-label="Filter kategori ${category}"
                >
                    ${category}
                </button>
            `).join('');

            const productCards = displayedProducts.length > 0 ? displayedProducts.map(product => `
                <div class="comic-card overflow-hidden transform transition duration-300 ease-in-out hover:scale-105 hover:shadow-xl animate-fadeIn" data-aos="fade-up">
                    <img
                        src="${product.image}"
                        alt="${product.name}"
                        class="w-full h-48 object-cover cursor-pointer product-image-thumbnail"
                        data-image-src="${product.image}"
                        data-image-caption="${product.name}"
                        onerror="this.onerror=null;this.src='https://placehold.co/400x300/ADD8E6/000000?text=${encodeURIComponent(product.name)}';"
                    />
                    <div class="p-5">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2 line-clamp-2">${product.name}</h3>
                        <div class="flex items-center mb-2">
                            <div class="text-lg mr-2">${getStarRatingHtml(product.rating)}</div>
                            <span class="text-gray-600 text-sm">(${product.rating})</span>
                        </div>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">${product.description}</p>
                        <div class="flex justify-end items-center">
                            <button data-product-id="${product.id}" class="btn-primary-gradient text-white text-sm font-medium py-2 px-4 rounded-full transition duration-300 quick-view-button" aria-label="Lihat Cepat ${product.name}">
                                Lihat Cepat
                            </button>
                        </div>
                    </div>
                </div>
            `).join('') : `<p class="col-span-full text-center text-gray-600 text-lg py-10">Produk tidak ditemukan.</p>`;

            const loadMoreButtonHtml = (loadedProductCount < filteredProducts.length) ?
                `<button id="load-more-products" class="mt-8 btn-secondary text-white font-semibold py-3 px-8 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Muat lebih banyak produk">
                    Muat Lebih Banyak Produk
                </button>` : '';

            return `
                <div class="container mx-auto px-4 py-12">
                    <div class="comic-section-bg animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-4 comic-section-title">Produk Unggulan UMKM Desa Srigonco</h2>
                        <p class="text-lg text-gray-700 text-center mb-10 max-w-2xl mx-auto font-semibold">
                            "Jelajahi Kekayaan Lokal: Kualitas Terbaik dari Hati Desa Srigonco."
                        </p>
                        <div class="max-w-xl mx-auto mb-8 flex flex-col sm:flex-row gap-4">
                            <input
                                type="text"
                                id="umkm-search-input"
                                placeholder="Cari produk..."
                                class="flex-grow p-3 border border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 transition duration-200"
                                value="${searchTerm}"
                                aria-label="Cari produk"
                            />
                            <select id="umkm-sort-dropdown" class="p-3 border border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 transition duration-200" aria-label="Urutkan produk">
                                <option value="default" ${selectedSort === 'default' ? 'selected' : ''}>Urutkan</option>
                                <option value="name-asc" ${selectedSort === 'name-asc' ? 'selected' : ''}>Nama (A-Z)</option>
                                <option value="name-desc" ${selectedSort === 'name-desc' ? 'selected' : ''}>Nama (Z-A)</option>
                            </select>
                        </div>
                        <div class="flex flex-wrap justify-center gap-3 mb-10">
                            ${categoryButtonsHtml}
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                            ${productCards}
                        </div>
                        <div class="text-center">
                            ${loadMoreButtonHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProductDetailPage() {
            if (!selectedProduct) {
                return `<div class="text-center py-12 text-gray-600">Produk tidak ditemukan.</div>`;
            }

            // Simulate recommended products based on category
            const recommendedProducts = products.filter(p =>
                p.category === selectedProduct.category && p.id !== selectedProduct.id
            ).slice(0, 3).map(p => `
                <div class="comic-card p-4 text-center">
                    <img src="${p.image}" alt="${p.name}" class="w-full h-32 object-cover rounded-md mb-3" onerror="this.onerror=null;this.src='https://placehold.co/200x150/ADD8E6/000000?text=${encodeURIComponent(p.name)}';" />
                    <h4 class="font-semibold text-gray-800 text-md mb-1 line-clamp-1">${p.name}</h4>
                    <button onclick="navigateTo('productDetail', ${p.id})" class="btn-primary-gradient text-white text-xs py-1 px-3 rounded-full" aria-label="Lihat detail ${p.name}">
                        Lihat
                    </button>
                </div>
            `).join('');

            return `
                <div class="container mx-auto px-4 py-12">
                    <div class="comic-section-bg max-w-4xl mx-auto animate-fadeIn" data-aos="fade-up">
                        <button onclick="navigateTo('umkm')" class="mb-6 inline-flex items-center text-blue-600 hover:text-blue-800 font-medium transition duration-300" aria-label="Kembali ke halaman produk">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            Kembali ke Produk
                        </button>
                        <div class="md:flex md:space-x-8">
                            <div class="md:w-1/2">
                                <img
                                    src="${selectedProduct.image}"
                                    alt="${selectedProduct.name}"
                                    class="w-full h-auto rounded-lg shadow-md mb-6 md:mb-0 cursor-pointer product-image-thumbnail"
                                    data-image-src="${selectedProduct.image}"
                                    data-image-caption="${selectedProduct.name}"
                                    onerror="this.onerror=null;this.src='https://placehold.co/600x400/ADD8E6/000000?text=${encodeURIComponent(selectedProduct.name)}';"
                                />
                            </div>
                            <div class="md:w-1/2">
                                <h2 class="text-3xl font-bold text-gray-900 mb-3">${selectedProduct.name}</h2>
                                <div class="flex items-center mb-4">
                                    <div class="text-2xl mr-2">${getStarRatingHtml(selectedProduct.rating)}</div>
                                    <span class="text-gray-600 text-lg">(${selectedProduct.rating} dari 5)</span>
                                </div>
                                <p class="text-gray-700 leading-relaxed mb-6">${selectedProduct.description}</p>
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">Detail Produk:</h3>
                                <p class="text-gray-600 leading-relaxed mb-4">${selectedProduct.details}</p>
                                <p class="text-gray-700 font-semibold mb-2">Stok Tersedia: <span class="text-teal-600">${selectedProduct.stock}</span></p>
                                <p class="text-gray-700 font-semibold mb-6">Alamat Penjual: <span class="text-teal-600">${selectedProduct.address}</span></p>
                                <div class="flex flex-wrap gap-4 mb-6">
                                    <a
                                        href="https://wa.me/${selectedProduct.whatsapp}?text=Halo%2C%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(selectedProduct.name)}%20yang%20ada%20di%20website%20Desa%20Srigonco."
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="inline-flex items-center btn-primary-gradient text-white font-semibold py-3 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105"
                                        aria-label="Beli via WhatsApp"
                                    >
                                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12.04 2C7.34 2 3.54 5.79 3.54 10.49c0 1.76.54 3.42 1.48 4.85L3 21.04l5.24-1.38c1.33.72 2.85 1.15 4.08 1.15 4.71 0 8.5-3.79 8.5-8.49S16.74 2 12.04 2zm3.39 12.24c-.16.27-.99.64-1.37.69-.37.05-.64.08-.92-.08-.27-.16-.99-.37-1.27-.85-.27-.47-.03-.72-.22-.92-.19-.19-.42-.27-.64-.27-.16 0-.34.03-.52.03-.19 0-.47.08-.72.34-.27.27-1.04 1.04-1.04 2.54s1.07 2.94 1.22 3.12c.16.19 2.03 3.12 4.93 4.35 2.39.99 2.85.79 3.34.79.47 0 .99-.19 1.15-.37.16-.19.27-.37.42-.64.16-.27.16-.47.11-.85-.05-.37-.19-.64-.37-.92-.16-.27-.37-.42-.52-.52-.16-.16-.34-.27-.47-.27-.16 0-.34.03-.52.11z" />
                                        </svg>
                                        Beli via WhatsApp
                                    </a>
                                    <button id="share-product-button" class="inline-flex items-center btn-secondary text-white font-semibold py-3 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Bagikan produk ini">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.865 13.111 9 12.87 9 12.5c0-.37.135-.611.316-.842l.006-.007a.5.5 0 01.707 0l.006.007c.181.231.316.472.316.842s-.135.611-.316.842l-.006.007a.5.5 0 01-.707 0l-.006-.007zM12 18h.01M12 6h.01M12 12h.01M12 12a.5.5 0 01.707 0l.006.007c.181.231.316.472.316.842s-.135.611-.316.842l-.006.007a.5.5 0 01-.707 0l-.006-.007zM12 18a.5.5 0 01.707 0l.006.007c.181.231.316.472.316.842s-.135.611-.316.842l-.006.007a.5.5 0 01-.707 0l-.006-.007zM12 6a.5.5 0 01.707 0l.006.007c.181.231.316.472.316.842s-.135.611-.316.842l-.006-.007a.5.5 0 01-.707 0l-.006-.007z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3M6 9v3m0 0v3m0-3h3m-3 0h-3M9 6h3m0 0h3M9 18h3m0 0h3"></path></svg>
                                        Bagikan Produk
                                    </button>
                                    <button id="copy-link-button" class="inline-flex items-center bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Salin tautan produk">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m-4 4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                        Salin Tautan
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-12">
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">Berikan Penilaian Anda</h3>
                            <div id="rating-input" class="flex justify-center text-4xl">
                                ${getStarRatingHtml(currentProductRating, true)}
                            </div>
                            <p id="rating-message" class="text-center text-sm text-gray-600 mt-2">Klik bintang untuk memberi nilai.</p>
                        </div>

                        ${recommendedProducts.length > 0 ? `
                            <div class="mt-12 border-t border-gray-200 pt-8">
                                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center comic-section-title">Rekomendasi Produk Serupa</h3>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                    ${recommendedProducts}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderGaleriPage() {
            let filteredGalleryImages = galleryImages.filter(img =>
                (selectedGalleryCategory === 'Semua' || img.category === selectedGalleryCategory)
            );

            const galleryCategoryButtonsHtml = galleryCategories.map(category => `
                <button
                    class="category-button px-5 py-2 rounded-full text-sm font-medium transition duration-300
                    ${selectedGalleryCategory === category ? 'active' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}"
                    data-category="${category}"
                    aria-label="Filter kategori ${category}"
                >
                    ${category}
                </button>
            `).join('');

            const displayedGalleryImages = filteredGalleryImages.slice(0, loadedGalleryCount);

            const galleryHtml = displayedGalleryImages.length > 0 ? displayedGalleryImages.map(img => `
                <div class="comic-card overflow-hidden transform transition duration-300 ease-in-out hover:scale-105 hover:shadow-xl animate-fadeIn" data-aos="fade-up">
                    <img
                        src="${img.src}"
                        alt="${img.title}"
                        class="w-full h-64 object-cover cursor-pointer gallery-image-thumbnail"
                        data-image-src="${img.src}"
                        data-image-caption="${img.title}"
                        onerror="this.onerror=null;this.src='https://placehold.co/800x600/ADD8E6/000000?text=${encodeURIComponent(img.title)}';"
                    />
                    <div class="p-4 text-center">
                        <p class="font-semibold text-gray-800">${img.title}</p>
                    </div>
                </div>
            `).join('') : `<p class="col-span-full text-center text-gray-600 text-lg py-10">Tidak ada gambar dalam kategori ini.</p>`;

            const loadMoreButtonHtml = (loadedGalleryCount < filteredGalleryImages.length) ?
                `<button id="load-more-gallery" class="mt-8 btn-secondary text-white font-semibold py-3 px-8 rounded-full shadow-md transition duration-300 ease-in-out transform hover:scale-105" aria-label="Muat lebih banyak foto galeri">
                    Muat Lebih Banyak Foto
                </button>` : '';

            return `
                <div class="container mx-auto px-4 py-12">
                    <div class="comic-section-bg animate-fadeIn" data-aos="fade-up">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-10 comic-section-title">Galeri Foto Desa Srigonco</h2>
                        <p class="text-lg text-gray-700 text-center mb-12 max-w-2xl mx-auto">
                            Jelajahi keindahan dan aktivitas di Desa Srigonco melalui koleksi foto kami. Dari pemandangan alam hingga kegiatan masyarakat dan UMKM.
                        </p>
                        <div class="flex flex-wrap justify-center gap-3 mb-10">
                            ${galleryCategoryButtonsHtml}
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                            ${galleryHtml}
                        </div>
                        <div class="text-center">
                            ${loadMoreButtonHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Event Handlers ---

        function handleSearchInput(event) {
            searchTerm = event.target.value;
            loadedProductCount = itemsPerPage; // Reset pagination on new search
            renderContent(); // Re-render UMKM page with filtered results
        }

        function handleCategoryFilter(event) {
            selectedCategory = event.target.dataset.category;
            loadedProductCount = itemsPerPage; // Reset pagination on new filter
            renderContent(); // Re-render UMKM page with filtered results
        }

        function handleSortChange(event) {
            selectedSort = event.target.value;
            loadedProductCount = itemsPerPage; // Reset pagination on new sort
            renderContent(); // Re-render UMKM page with new sort order
        }

        function handleGalleryCategoryFilter(event) {
            selectedGalleryCategory = event.target.dataset.category;
            loadedGalleryCount = itemsPerPage; // Reset pagination on new filter
            renderContent(); // Re-render gallery page with filtered results
        }

        function loadMoreProducts() {
            loadedProductCount += itemsPerPage;
            renderContent();
        }

        function loadMoreGallery() {
            loadedGalleryCount += itemsPerPage;
            renderContent();
        }

        function handleImageClickToModal(event) {
            const modal = document.getElementById('product-image-modal');
            const modalImage = document.getElementById('modal-image');
            const modalCaption = document.getElementById('modal-caption');
            const downloadButton = document.getElementById('download-image-button');

            modalImage.src = event.target.dataset.imageSrc;
            modalCaption.textContent = event.target.dataset.imageCaption; // Corrected to imageCaption
            downloadButton.href = event.target.dataset.imageSrc; // Set download link
            downloadButton.download = event.target.dataset.imageCaption.replace(/\s/g, '_') + '.jpg'; // Set filename

            modal.classList.add('open');
        }

        function closeImageModal() {
            const modal = document.getElementById('product-image-modal');
            modal.classList.remove('open');
        }

        function downloadModalImage() {
            const modalImage = document.getElementById('modal-image');
            const imageUrl = modalImage.src;
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = modalImage.alt.replace(/\s/g, '_') + '.jpg'; // Use alt text for filename
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function openProductQuickViewModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const modal = document.getElementById('product-quick-view-modal');
            document.getElementById('quick-view-image').src = product.image;
            document.getElementById('quick-view-image').alt = product.name;
            document.getElementById('quick-view-name').textContent = product.name;
            document.getElementById('quick-view-rating').innerHTML = getStarRatingHtml(product.rating);
            document.getElementById('quick-view-description').textContent = product.description;
            document.getElementById('quick-view-stock').textContent = `Stok: ${product.stock}`;
            document.getElementById('quick-view-address').textContent = `Alamat: ${product.address}`;
            document.getElementById('quick-view-whatsapp').href = `https://wa.me/${product.whatsapp}?text=Halo%2C%20saya%20tertarik%20dengan%20produk%20${encodeURIComponent(product.name)}%20yang%20ada%20di%20website%20Desa%20Srigonco.`;
            // Set data-product-id on the detail button so we can navigate to full detail
            document.getElementById('quick-view-detail-button').dataset.productId = product.id;

            modal.classList.add('open');
        }

        function closeProductQuickViewModal() {
            const modal = document.getElementById('product-quick-view-modal');
            modal.classList.remove('open');
        }

        function handleQuickViewDetailClick(event) {
            const productId = parseInt(event.target.dataset.productId);
            closeProductQuickViewModal(); // Close quick view modal first
            navigateTo('productDetail', productId); // Navigate to full detail page
        }

        /**
         * Highlights stars on hover for interactive rating.
         * @param {Event} event - The mouseover event.
         * @param {number} [forceRating] - Optional: A specific rating to highlight (used for initial render).
         */
        function highlightStars(event, forceRating = null) {
            const ratingInputDiv = document.getElementById('rating-input');
            if (!ratingInputDiv) return;

            const stars = ratingInputDiv.querySelectorAll('.rating-star');
            const hoverRating = event ? parseInt(event.target.dataset.star) : forceRating;

            stars.forEach(star => {
                const starValue = parseInt(star.dataset.star);
                if (starValue <= hoverRating) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
        }

        /**
         * Resets stars to the current selected rating on mouseout.
         */
        function resetStars() {
            const ratingInputDiv = document.getElementById('rating-input');
            if (!ratingInputDiv) return;

            const stars = ratingInputDiv.querySelectorAll('.rating-star');
            stars.forEach(star => {
                const starValue = parseInt(star.dataset.star);
                if (starValue <= currentProductRating) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
        }

        /**
         * Sets the product rating on click.
         * @param {Event} event - The click event.
         */
        function setRating(event) {
            const newRating = parseInt(event.target.dataset.star);
            currentProductRating = newRating;
            const ratingMessage = document.getElementById('rating-message');
            if (ratingMessage) {
                ratingMessage.textContent = `Anda memberi nilai ${newRating} bintang. Terima kasih!`;
            }
            highlightStars(null, newRating); // Ensure stars stay highlighted

            // In a real application, this is where you would send the rating to a backend
            console.log(`Produk ID ${selectedProduct.id} diberi nilai ${newRating} bintang.`);
            // Simulate sending to backend
            toggleLoading(true);
            setTimeout(() => {
                toggleLoading(false);
                // Update selectedProduct.rating if this were a real update
                // selectedProduct.rating = newRating;
                // renderContent(); // Re-render to show updated average rating if applicable
            }, 500);
        }

        /**
         * Shares the current product's URL and title using the Web Share API if available,
         * otherwise provides a fallback for WhatsApp and clipboard.
         */
        function shareProduct() {
            if (!selectedProduct) return;

            const productUrl = window.location.origin + window.location.pathname + '?page=productDetail&id=' + selectedProduct.id;
            const shareText = `Lihat produk UMKM menarik ini dari Desa Srigonco: ${selectedProduct.name}. Selengkapnya di: ${productUrl}`;

            if (navigator.share) {
                navigator.share({
                    title: selectedProduct.name,
                    text: shareText,
                    url: productUrl,
                }).then(() => {
                    console.log('Produk berhasil dibagikan.');
                }).catch((error) => {
                    console.error('Gagal membagikan produk:', error);
                    // Fallback if share fails or is cancelled
                    fallbackShare(productUrl, shareText);
                });
            } else {
                fallbackShare(productUrl, shareText);
            }
        }

        function copyProductLink() {
            if (!selectedProduct) return;

            const productUrl = window.location.origin + window.location.pathname + '?page=productDetail&id=' + selectedProduct.id;
            const el = document.createElement('textarea');
            el.value = productUrl;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            customAlert('Tautan produk telah disalin ke clipboard!');
        }

        function fallbackShare(url, text) {
            // Provide options for WhatsApp and copy to clipboard
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;

            // Use a custom confirmation dialog or a simple alert as window.confirm is not allowed
            const customConfirm = (message, onConfirm, onCancel) => {
                const modalBackdrop = document.createElement('div');
                modalBackdrop.className = 'custom-modal-backdrop';
                modalBackdrop.setAttribute('role', 'dialog');
                modalBackdrop.setAttribute('aria-modal', 'true');
                modalBackdrop.innerHTML = `
                    <div class="custom-modal-content">
                        <p class="text-gray-800 text-lg mb-6">${message}</p>
                        <div class="flex justify-center space-x-4">
                            <button id="confirm-ok" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-5 rounded-md transition duration-300" aria-label="Bagikan via WhatsApp">OK (WhatsApp)</button>
                            <button id="confirm-cancel" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-5 rounded-md transition duration-300" aria-label="Salin tautan">Batal (Salin Tautan)</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modalBackdrop);
                setTimeout(() => modalBackdrop.classList.add('open'), 10); // Animate in

                document.getElementById('confirm-ok').onclick = () => {
                    modalBackdrop.classList.remove('open');
                    setTimeout(() => modalBackdrop.remove(), 300); // Animate out then remove
                    onConfirm();
                };
                document.getElementById('confirm-cancel').onclick = () => {
                    modalBackdrop.classList.remove('open');
                    setTimeout(() => modalBackdrop.remove(), 300); // Animate out then remove
                    onCancel();
                };
            };

            customConfirm(
                "Web Share API tidak didukung. Apakah Anda ingin membagikan via WhatsApp atau menyalin tautan?",
                () => { // On Confirm (OK)
                    window.open(whatsappUrl, '_blank');
                },
                () => { // On Cancel (Batal)
                    // Copy to clipboard
                    const el = document.createElement('textarea');
                    el.value = url;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);
                    customAlert('Tautan produk telah disalin ke clipboard!');
                }
            );
        }

        // Custom alert function
        function customAlert(msg) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-75 text-white px-6 py-3 rounded-md shadow-lg z-50 animate-fadeIn';
            alertDiv.textContent = msg;
            document.body.appendChild(alertDiv);
            setTimeout(() => {
                alertDiv.remove();
            }, 2000);
        }

        // --- Carousel Logic (Hero Section) ---
        function showCarouselItem(index) {
            const items = document.querySelectorAll('#image-carousel .carousel-item');
            if (items.length === 0) return;

            items.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            currentCarouselIndex = index;
        }

        function showNextCarouselItem() {
            const items = document.querySelectorAll('#image-carousel .carousel-item');
            if (items.length === 0) return;
            currentCarouselIndex = (currentCarouselIndex + 1) % items.length;
            showCarouselItem(currentCarouselIndex);
            resetCarouselInterval();
        }

        function showPrevCarouselItem() {
            const items = document.querySelectorAll('#image-carousel .carousel-item');
            if (items.length === 0) return;
            currentCarouselIndex = (currentCarouselIndex - 1 + items.length) % items.length;
            showCarouselItem(currentCarouselIndex);
            resetCarouselInterval();
        }

        function startCarousel() {
            if (carouselInterval) {
                clearInterval(carouselInterval);
            }
            carouselInterval = setInterval(showNextCarouselItem, 5000); // Change image every 5 seconds
        }

        function resetCarouselInterval() {
            clearInterval(carouselInterval);
            startCarousel();
        }

        // --- Utility Functions ---

        // Toggle mobile menu visibility
        function toggleMobileMenu(forceState = null) {
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            if (forceState !== null) {
                if (forceState) {
                    mobileMenuOverlay.classList.remove('hidden');
                    mobileMenuOverlay.classList.add('visible');
                } else {
                    mobileMenuOverlay.classList.remove('visible');
                    mobileMenuOverlay.classList.add('hidden');
                }
            } else {
                mobileMenuOverlay.classList.toggle('hidden');
                mobileMenuOverlay.classList.toggle('visible');
            }
        }

        // Update active navigation link in header and mobile menu
        function updateActiveNavLink() {
            const navLinks = [
                { id: 'nav-home', page: 'home' },
                { id: 'nav-umkm', page: 'umkm' },
                { id: 'nav-galeri', page: 'galeri' }
            ];

            navLinks.forEach(link => {
                const desktopButton = document.getElementById(link.id);
                const mobileButton = document.getElementById(`mobile-${link.id}`);

                if (desktopButton) {
                    if (link.page === currentPage) {
                        desktopButton.classList.add('active');
                    } else {
                        desktopButton.classList.remove('active');
                    }
                }
                if (mobileButton) {
                    if (link.page === currentPage) {
                        mobileButton.classList.add('text-teal-400');
                        mobileButton.classList.remove('text-white');
                    } else {
                        mobileButton.classList.remove('text-teal-400');
                        mobileButton.classList.add('text-white');
                    }
                }
            });
        }


        // Scroll to top functionality
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Intersection Observer for scroll animations (AOS-like)
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const delay = parseInt(entry.target.dataset.aosDelay) || 0;
                    if (entry.target.classList.contains('text-reveal')) {
                        // For text-reveal, apply animation directly
                        entry.target.style.animationDelay = `${delay}ms`;
                        entry.target.style.opacity = 1; // Make it visible
                    } else {
                        // For other elements, add a class that triggers animation
                        // Using animate-fadeInUp for general fade/slide up
                        entry.target.classList.add('animate-fadeInUp');
                        entry.target.style.animationDelay = `${delay}ms`;
                    }
                    observer.unobserve(entry.target); // Stop observing once animated
                }
            });
        }, {
            threshold: 0.1, // Trigger when 10% of the element is visible
            rootMargin: '0px 0px -50px 0px' // Start animation a bit earlier
        });

        function setupIntersectionObserver() {
            document.querySelectorAll('[data-aos]').forEach(element => {
                element.classList.remove('animate-fadeInUp', 'text-reveal'); // Remove previous animations
                element.style.opacity = 0; // Hide elements initially for animation
                observer.observe(element);
            });
        }

        // --- Chatbot Logic ---
        let chatHistory = []; // Stores chat messages for context

        function toggleChatbot() {
            const chatbotContainer = document.getElementById('chatbot-container');
            chatbotContainer.classList.toggle('open');
            // Toggle 'hidden' class for visibility transition
            if (chatbotContainer.classList.contains('open')) {
                chatbotContainer.classList.remove('hidden');
                document.getElementById('chatbot-input').focus(); // Focus input when opened
            } else {
                // Add a small delay before hiding to allow transition to complete
                setTimeout(() => {
                    chatbotContainer.classList.add('hidden');
                }, 300);
            }
        }

        function appendMessage(sender, text) {
            const messagesDiv = document.getElementById('chatbot-messages');
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble');
            if (sender === 'user') {
                messageBubble.classList.add('user-message');
            } else {
                messageBubble.classList.add('bot-message');
            }
            messageBubble.textContent = text;
            messagesDiv.appendChild(messageBubble);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll to bottom
        }

        async function sendChatMessage() {
            const inputField = document.getElementById('chatbot-input');
            const userMessage = inputField.value.trim();

            if (userMessage === '') return;

            appendMessage('user', userMessage);
            chatHistory.push({ role: 'user', parts: [{ text: userMessage }] });
            inputField.value = ''; // Clear input

            // Add a typing indicator
            const messagesDiv = document.getElementById('chatbot-messages');
            const typingIndicator = document.createElement('div');
            typingIndicator.classList.add('message-bubble', 'bot-message', 'typing-indicator');
            typingIndicator.innerHTML = '<span>.</span><span>.</span><span>.</span>';
            typingIndicator.id = 'typing-indicator';
            messagesDiv.appendChild(typingIndicator);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            try {
                // Updated prompt for the chatbot
                const prompt = `Anda adalah chatbot untuk website UMKM Desa Srigonco. Anda memiliki informasi tentang produk UMKM dan juga tentang Desa Srigonco secara umum.

                Data produk UMKM yang Anda miliki: ${JSON.stringify(products)}.

                Informasi umum tentang Desa Srigonco:
                -   **Lokasi:** Desa Srigonco terletak di Kecamatan Bantur, Kabupaten Malang, Jawa Timur.
                -   **Fokus:** Desa ini berfokus pada pengembangan UMKM lokal yang inovatif, memanfaatkan kekayaan alam dan budaya setempat.
                -   **Tujuan:** Membangun desa mandiri dan sejahtera melalui potensi UMKM.
                -   **Keindahan Alam:** Desa Srigonco memiliki pemandangan yang asri dan tenang, seperti sawah hijau dan sungai jernih.
                -   **Budaya:** Masyarakat Srigonco menjunjung tinggi semangat gotong royong dan kreativitas dalam menghasilkan produk.

                Saat menjawab pertanyaan pengguna, mohon ikuti instruksi berikut:
                1.  **Jika pengguna menanyakan tentang produk tertentu** (misalnya "apa itu Fadin Snack?", "detail Batik Tulis?", "berapa stok Pretty Donat?", "alamat penjual Keripik Pangsit?"):
                    * Cari produk yang relevan dalam data \`products\`.
                    * Berikan informasi lengkap yang relevan dari data produk (nama, deskripsi, kategori, stok, dan alamat penjual).
                    * **Sertakan nomor WhatsApp penjual dalam format yang siap diklik (misalnya: "Anda bisa menghubungi penjual di WhatsApp: wa.me/6281234567890").**
                    * Jika relevan, sarankan produk lain yang serupa atau dalam kategori yang sama.
                2.  **Jika pengguna menanyakan tentang kategori produk** (misalnya "produk makanan kering apa saja?", "kerajinan yang tersedia?"):
                    * Sebutkan nama-nama produk yang termasuk dalam kategori tersebut dari data \`products\`.
                    * Jika ada banyak, sebutkan beberapa contoh dan tawarkan untuk melihat semua di halaman UMKM.
                3.  **Jika pengguna menanyakan tentang Desa Srigonco secara umum** (misalnya "di mana Desa Srigonco?", "apa fokus desa ini?", "bagaimana budaya di Srigonco?", "apa saja keindahan alam di Srigonco?"):
                    * Berikan informasi yang relevan dari "Informasi umum tentang Desa Srigonco" di atas.
                    * Jaga jawaban tetap ringkas dan informatif.
                4.  **Jika Anda tidak menemukan produk atau informasi yang relevan** dalam data Anda:
                    * Katakan dengan sopan bahwa produk/informasi tersebut tidak ditemukan.
                    * **Tawarkan untuk membantu mencari produk lain atau menyarankan untuk menghubungi admin website melalui WhatsApp umum (misalnya: "Anda bisa menghubungi admin kami di WhatsApp: wa.me/6281234567890 untuk bantuan lebih lanjut.").**
                5.  **Jaga nada bicara** tetap ramah, membantu, dan profesional.
                6.  **Jangan berikan informasi yang tidak ada dalam data produk atau informasi umum desa** yang Anda miliki.
                7.  **Jika pertanyaan sangat umum atau di luar lingkup produk dan informasi desa** (misalnya "apa kabar?", "cuaca hari ini?"), berikan jawaban umum yang ramah dan tawarkan bantuan terkait produk UMKM atau informasi Desa Srigonco.

                Pertanyaan pengguna: ${userMessage}`;

                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "text/plain", // Request plain text response
                    }
                };
                const apiKey = ""; // Canvas will automatically provide this
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                let botResponseText = 'Maaf, saya tidak dapat memproses permintaan Anda saat ini. Silakan coba lagi.';

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    botResponseText = result.candidates[0].content.parts[0].text;
                } else {
                    console.error('Unexpected response structure from Gemini API:', result);
                }

                // Remove typing indicator
                const existingTypingIndicator = document.getElementById('typing-indicator');
                if (existingTypingIndicator) {
                    existingTypingIndicator.remove();
                }

                appendMessage('bot', botResponseText);
                chatHistory.push({ role: 'model', parts: [{ text: botResponseText }] });

            } catch (error) {
                console.error('Error fetching from Gemini API:', error);
                // Remove typing indicator
                const existingTypingIndicator = document.getElementById('typing-indicator');
                if (existingTypingIndicator) {
                    existingTypingIndicator.remove();
                }
                appendMessage('bot', 'Maaf, terjadi kesalahan saat menghubungi server. Silakan coba lagi nanti.');
            }
        }

        function handleChatInputKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }


        // Initializations ---

        // Event listener for "Back to Top" button visibility
        window.addEventListener('scroll', () => {
            const backToTopButton = document.getElementById('back-to-top-button');
            if (window.scrollY > 300) {
                if (!showBackToTop) {
                    backToTopButton.classList.remove('hidden');
                    showBackToTop = true;
                }
            } else {
                if (showBackToTop) {
                    backToTopButton.classList.add('hidden');
                    showBackToTop = false;
                }
            }
        });

        // Initial render when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Define products and gallery data here, inside DOMContentLoaded
            products = [
                {
                    id: 1,
                    name: 'Fadin Snack',
                    description: 'Aneka snack kering dari Fadin Gallery, cocok untuk camilan. Diproduksi sesuai pesanan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Fadin+Snack',
                    details: 'Produk makanan kering. Pemasaran dalam desa. Produksi sesuai pesanan (PO).',
                    whatsapp: '6281336531898',
                    category: 'Makanan Kering',
                    rating: 4.5,
                    stock: 'Berdasarkan Pesanan',
                    keywords: ['snack', 'makanan kering', 'fadin', 'camilan'],
                    address: 'Dusun Sumberjambe RT 35'
                },
                {
                    id: 2,
                    name: 'Fadin Gallery Kerajinan',
                    description: 'Berbagai kerajinan tangan dari Fadin Gallery. Dibuat dengan detail dan kualitas.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Fadin+Gallery',
                    details: 'Produk kerajinan. Pemasaran dalam desa. Produksi sesuai pesanan (PO).',
                    whatsapp: '6281336531898',
                    category: 'Kerajinan',
                    rating: 4.7,
                    stock: 'Berdasarkan Pesanan',
                    keywords: ['kerajinan', 'fadin', 'gallery', 'hiasan'],
                    address: 'Dusun Sumberjambe RT 35'
                },
                {
                    id: 3,
                    name: 'SALAD BUAH Vani Wijayanti',
                    description: 'Salad buah segar, cocok untuk camilan sehat setiap hari. Dibuat dengan buah pilihan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Salad+Buah',
                    details: 'Produk makanan basah. Pemasaran dalam desa. Produksi setiap hari.',
                    whatsapp: '6282143167792',
                    category: 'Makanan Basah',
                    rating: 4.8,
                    stock: 'Tersedia Setiap Hari',
                    keywords: ['salad', 'buah', 'sehat', 'camilan', 'segar'],
                    address: 'Sumberjambe RT 40 RW 06'
                },
                {
                    id: 4,
                    name: 'Pretty Donat',
                    description: 'Donat empuk dengan aneka topping menarik dari Pretty Ana. Tersedia setiap hari atau sesuai pesanan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Pretty+Donat',
                    details: 'Produk makanan kering (donat). Pemasaran dalam desa. Produksi setiap hari atau sesuai pesanan.',
                    whatsapp: '6282245943031',
                    category: 'Makanan Kering',
                    rating: 4.6,
                    stock: 'Tersedia / Berdasarkan Pesanan',
                    keywords: ['donat', 'pretty', 'roti', 'manis'],
                    address: 'Srigonco Watu Sigar RT 2'
                },
                {
                    id: 5,
                    name: 'Aneka Kue Dwi Purwati',
                    description: 'Berbagai macam kue kering dan basah, cocok untuk acara atau camilan. Dibuat sesuai pesanan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Aneka+Kue',
                    details: 'Produk makanan kering dan basah. Pemasaran dalam dan luar desa. Produksi sesuai pesanan (PO).',
                    whatsapp: '6281217205508',
                    category: 'Makanan',
                    rating: 4.7,
                    stock: 'Berdasarkan Pesanan',
                    keywords: ['kue', 'kue kering', 'kue basah', 'camilan'],
                    address: 'Watusigar RT 24/04, Desa Srigonco'
                },
                {
                    id: 6,
                    name: 'Makanan dan Aneka Minuman Muhamad Akbar',
                    description: 'Berbagai pilihan makanan kering dan aneka minuman segar. Tersedia setiap hari.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Makanan+Minuman',
                    details: 'Produk makanan kering dan minuman. Pemasaran dalam desa. Produksi setiap hari.',
                    whatsapp: '6285815365961',
                    category: 'Makanan & Minuman',
                    rating: 4.3,
                    stock: 'Tersedia Setiap Hari',
                    keywords: ['makanan', 'minuman', 'snack', 'segar'],
                    address: 'Srigonco RT 15'
                },
                {
                    id: 7,
                    name: 'Sosis Bakar & Corndog Khusnul Khatimah',
                    description: 'Sosis bakar dan corndog lezat, cocok untuk camilan atau jajanan. Dibuat sesuai pesanan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Sosis+Corndog',
                    details: 'Produk makanan basah. Pemasaran dalam desa. Produksi sesuai pesanan (PO).',
                    whatsapp: '6282232158608',
                    category: 'Makanan Basah',
                    rating: 4.4,
                    stock: 'Berdasarkan Pesanan',
                    keywords: ['sosis bakar', 'corndog', 'jajanan', 'makanan basar'],
                    address: 'Dusun Sumberjambe RT 36'
                },
                {
                    id: 8,
                    name: 'Keripik Pangsit & Cireng Dewi Irawati',
                    description: 'Keripik pangsit renyah dan cireng gurih, tersedia untuk dalam dan luar desa. Produksi setiap hari atau sesuai pesanan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Keripik+Pangsit',
                    details: 'Produk makanan kering dan makanan basah. Pemasaran dalam desa, luar desa. Produksi setiap hari, sesuai pesanan.',
                    whatsapp: '6281216659745',
                    category: 'Makanan Kering',
                    rating: 4.6,
                    stock: 'Tersedia / Berdasarkan Pesanan',
                    keywords: ['keripik pangsit', 'cireng', 'camilan', 'gurih'],
                    address: 'Desa Srigonco, Dusun Sumberjambe'
                },
                {
                    id: 9,
                    name: 'Snack & Minuman Silvia Puji Rahayu',
                    description: 'Berbagai pilihan snack kering dan minuman segar dari Silvia Puji Rahayu. Dibuat sesuai pesanan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Snack+Minuman',
                    details: 'Produk makanan kering dan minuman. Pemasaran dalam desa. Produksi sesuai pesanan (PO).',
                    whatsapp: '6281246787759',
                    category: 'Makanan & Minuman',
                    rating: 4.5,
                    stock: 'Berdasarkan Pesanan',
                    keywords: ['snack', 'minuman', 'camilan', 'segar'],
                    address: 'Dsn. Sumber Jambe, RT/RW tidak spesifik'
                },
                {
                    id: 10,
                    name: 'Minuman Alvia',
                    description: 'Aneka minuman segar dan olahan minuman dari Alvia. Tersedia setiap hari.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Minuman',
                    details: 'Produk minuman. Pemasaran dalam desa. Produksi setiap hari.',
                    whatsapp: '6285649796149',
                    category: 'Minuman',
                    rating: 4.2,
                    stock: 'Tersedia Setiap Hari',
                    keywords: ['minuman', 'segar', 'olahan'],
                    address: 'Sumberjambe RT 32'
                },
                {
                    id: 11,
                    name: 'Batik Tulis Lilis Setyowati',
                    description: 'Kain batik tulis asli dengan motif khas dari Lilis Setyowati. Cocok untuk pakaian atau koleksi.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Batik+Tulis',
                    details: 'Produk kerajinan batik. Pemasaran dalam dan luar desa. Produksi setiap hari.',
                    whatsapp: '6281336809484',
                    category: 'Kerajinan',
                    rating: 4.9,
                    stock: 'Tersedia Setiap Hari',
                    keywords: ['batik', 'tulis', 'kain', 'kerajinan', 'tradisional'],
                    address: 'Dusun Watusigar RT 2/RW tidak spesifik'
                },
                {
                    id: 12,
                    name: 'Stick Pepaya Pipit Meilandari',
                    description: 'Stick pepaya renyah dan manis, camilan unik dari Pipit Meilandari. Tersedia setiap hari.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Stick+Pepaya',
                    details: 'Produk makanan kering. Pemasaran dalam desa. Produksi setiap hari.',
                    whatsapp: '6285746346389',
                    category: 'Makanan Kering',
                    rating: 4.3,
                    stock: 'Tersedia Setiap Hari',
                    keywords: ['stick', 'pepaya', 'makanan kering', 'camilan'],
                    address: 'RT 11 RW 2 Krajan Srigonco'
                },
                {
                    id: 13,
                    name: 'Keripik Pisang & Aneka Es Siti Nur Aini',
                    description: 'Keripik pisang aneka rasa dan berbagai pilihan es segar dari Siti Nur Aini. Tersedia setiap hari atau sesuai pesanan.',
                    image: 'https://placehold.co/400x300/ADD8E6/000000?text=Keripik+Pisang+Es',
                    details: 'Produk makanan kering dan minuman. Pemasaran dalam desa. Produksi setiap hari, sesuai pesanan.',
                    whatsapp: '6281231135846',
                    category: 'Makanan & Minuman',
                    rating: 4.5,
                    stock: 'Tersedia / Berdasarkan Pesanan',
                    keywords: ['keripik pisang', 'es', 'makanan kering', 'minuman'],
                    address: 'Sukorame RT 24 RW 04'
                }
            ];
            // Dynamically generate product categories from the new products array
            productCategories = ['Semua', ...new Set(products.map(p => p.category))];

            galleryImages = [
                { id: 1, src: 'https://placehold.co/800x600/A7F3D0/065F46?text=Pemandangan+Sawah', title: 'Pemandangan Sawah Hijau', category: 'Pemandangan Alam' },
                { id: 2, src: 'https://placehold.co/800x600/FFDDC1/FF6F00?text=Panen+Padi', title: 'Aktivitas Panen Padi', category: 'Aktivitas Desa' },
                { id: 3, src: 'https://placehold.co/800x600/C1DFF0/0056b3?text=Sungai+Jernih', title: 'Sungai Jernih di Pedesaan', category: 'Pemandangan Alam' },
                { id: 4, src: 'https://placehold.co/800x600/D1FAE5/10B981?text=UMKM+Kerajinan', title: 'Proses Pembuatan Kerajinan', category: 'Produk UMKM' },
                { id: 5, src: 'https://placehold.co/800x600/FFDDC1/FF6F00?text=Festival+Desa', title: 'Suasana Festival Desa', category: 'Aktivitas Desa' },
                { id: 6, src: 'https://placehold.co/800x600/C1DFF0/0056b3?text=Warga+Berinteraksi', title: 'Interaksi Warga Desa', category: 'Aktivitas Desa' },
                { id: 7, src: 'https://placehold.co/800x600/A7F3D0/065F46?text=Produk+Madu', title: 'Produk Madu Hutan', category: 'Produk UMKM' },
                { id: 8, src: 'https://placehold.co/800x600/FFDDC1/FF6F00?text=Produk+Kopi', title: 'Produk Kopi Robusta', category: 'Produk UMKM' },
                { id: 9, src: 'https://placehold.co/800x600/C1DFF0/0056b3?text=Bukit+Hijau', title: 'Pemandangan Bukit Hijau', category: 'Pemandangan Alam' },
                { id: 10, src: 'https://placehold.co/800x600/D1FAE5/10B981?text=Olahan+Makanan', title: 'Produk Olahan Makanan', category: 'Produk UMKM' },
                { id: 11, src: 'https://placehold.co/800x600/FFDDC1/FF6F00?text=Pertanian+Modern', title: 'Inovasi Pertanian', category: 'Aktivitas Desa' },
                { id: 12, src: 'https://placehold.co/800x600/C1DFF0/0056b3?text=Lingkungan+Desa', title: 'Lingkungan Desa Bersih', category: 'Pemandangan Alam' },
            ];
            galleryCategories = ['Semua', ...new Set(galleryImages.map(img => img.category))];

            testimonials = [
                {
                    name: 'Budi Santoso',
                    title: 'Pengusaha Kuliner',
                    quote: 'Produk UMKM Desa Srigonco sangat berkualitas dan autentik. Saya sangat merekomendasikannya!',
                    avatar: 'https://placehold.co/80x80/ADD8E6/000000?text=BS'
                },
                {
                    name: 'Siti Aminah',
                    title: 'Pecinta Kerajinan',
                    quote: 'Kerajinan batiknya indah sekali, detailnya luar biasa. Bangga bisa mendukung produk lokal.',
                    avatar: 'https://placehold.co/80x80/ADD8E6/000000?text=SA'
                },
                {
                    name: 'Joko Susilo',
                    title: 'Wisatawan',
                    quote: 'Desa Srigonco asri dan produk makanannya lezat. Pengalaman belanja yang menyenangkan!',
                    avatar: 'https://placehold.co/80x80/ADD8E6/000000?text=JS'
                }
            ];


            // Set current year in footer
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // Initial page render
            navigateTo('home'); // Start on home page

            // Attach static event listeners
            document.getElementById('mobile-menu-button').addEventListener('click', () => toggleMobileMenu(true));
            document.getElementById('close-mobile-menu').addEventListener('click', () => toggleMobileMenu(false));
            document.getElementById('back-to-top-button').addEventListener('click', scrollToTop);
        });
    </script>
</body>
</html>
